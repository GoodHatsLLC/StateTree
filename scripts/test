#!/bin/bash

>/dev/null pushd "$(git rev-parse --show-toplevel)/scripts" || exit 1 ;

DIDFAIL=0

echo "ðŸ“ Test Suite"
echo ""

if uname | >/dev/null grep Darwin; then
  echo "âŒ›1ï¸âƒ£ macOS build (TreeActor == MainActor)"
  ./runswift -v test || DIDFAIL=1
  echo ""
  echo ""
  echo "âŒ›2ï¸âƒ£ macOS build (TreeActor != MainActor)"
  ./runswift -v -c test || DIDFAIL=1
  echo ""
  echo ""
else
  >&2 echo "â— no macOS builds"
  >&2 echo ""
  >&2 echo ""
  DIDFAIL=1
fi

>/dev/null pushd "$(git rev-parse --show-toplevel)" || exit 1 ;

if ./scripts/dkr uname | >/dev/null grep Linux; then
  echo "âŒ›3ï¸âƒ£ Linux build"
  ./scripts/dkr ./scripts/runswift -v test || DIDFAIL=1
  echo ""
  echo ""
else
  >&2 echo "â— no Linux build"
  >&2 echo ""
  >&2 echo ""
  DIDFAIL=1
fi

if [ $DIDFAIL != 0 ]; then
  >&2 echo "â›” Failures present"
  exit 1
else
  echo "âœ… Tests succeeded"
  exit 0
fi
